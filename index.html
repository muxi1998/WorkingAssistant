<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>安親班晚餐安排</title>
    <style>
        /* 基本的CSS樣式 */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr); /* 7天一週 */
            grid-gap: 5px;
            margin: 20px;
        }
        .calendar-day {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
            background-color: #f9f9f9;
        }
        .today {
            background-color: #bde0fe;
        }
        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr); /* 7天一週 */
            background-color: #f0f0f0;
            padding: 5px 0;
        }
        .calendar-header div {
            text-align: center;
            padding: 5px 0;
        }
        .calendar-day {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
            min-height: 100px; /* 確保有足夠的空間顯示晚餐資訊 */
        }
        .logo-container {
            position: fixed; /* 或者使用 absolute，根據需要 */
            top: 10px; /* 上邊距，可調整 */
            right: 10px; /* 右邊距，可調整 */
            z-index: 1000; /* 確保Logo在最上層 */
        }

        .logo-container img {
            height: 90px; /* Logo的高度，可根據需要調整 */
            width: auto; /* 保持圖片的寬高比 */
        }

    </style>
</head>
<body>

<div class="logo-container">
    <img src="imgs/logo.jpg" alt="Logo">
</div>

<div>
    <h1>安親班晚餐安排</h1>
    <h3 id="currentMonth"></h3>
</div>

<div id="calendar"></div>

<div>
    <input type="text" id="restaurantInput" placeholder="輸入餐廳名稱">
    <button onclick="addRestaurant()">添加餐廳</button>
    <button onclick="generateWeeklyMenu()">產生本週晚餐</button>
    <div id="restaurantList"></div>
</div>

<script>
    let restaurants = JSON.parse(localStorage.getItem('restaurants')) || [];

    function addRestaurant() {
        let restaurantName = document.getElementById('restaurantInput').value;
        if (restaurantName && restaurants.indexOf(restaurantName) === -1) {
            restaurants.push(restaurantName);
            localStorage.setItem('restaurants', JSON.stringify(restaurants));
            updateRestaurantList();
            document.getElementById('restaurantInput').value = '';
        }
    }

    function updateRestaurantList() {
        let listHtml = restaurants.map((restaurant, index) => 
            `<div>
                <input type="checkbox" id="restaurant${index}" name="restaurant" value="${restaurant}" checked>
                <label for="restaurant${index}">${restaurant}</label>
                <button onclick="deleteRestaurant(${index})">刪除</button>
            </div>`
        ).join('');
        document.getElementById('restaurantList').innerHTML = listHtml;
    }

    function deleteRestaurant(index) {
        // 從餐廳列表中移除指定索引的餐廳
        restaurants.splice(index, 1);
        // 更新顯示的餐廳列表
        updateRestaurantList();
        // 更新本地儲存的餐廳列表
        localStorage.setItem('restaurants', JSON.stringify(restaurants));
    }

    function generateWeeklyMenu() {
        let selectedRestaurants = [];
        document.querySelectorAll('#restaurantList input[type="checkbox"]:checked').forEach(checkbox => {
            selectedRestaurants.push(checkbox.value);
        });

        let daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
        let weekMenu = [];
        let availableRestaurants = [...selectedRestaurants];

        daysOfWeek.forEach((day, index) => {
            if (availableRestaurants.length > 0) {
                let randomIndex = Math.floor(Math.random() * availableRestaurants.length);
                let selectedRestaurant = availableRestaurants[randomIndex];
                weekMenu.push({day, restaurant: selectedRestaurant});
                // 如果餐廳數量等於4，則在選擇完四個餐廳後重置可用餐廳列表
                if (selectedRestaurants.length === 4 && index === 3) {
                    availableRestaurants = [...selectedRestaurants];
                } else if (selectedRestaurants.length > 4) {
                    // 避免重複
                    availableRestaurants.splice(randomIndex, 1);
                }
            } else if (selectedRestaurants.length > 0) {
                // 如果餐廳數量少於4，允許重複
                let randomIndex = Math.floor(Math.random() * selectedRestaurants.length);
                let selectedRestaurant = selectedRestaurants[randomIndex];
                weekMenu.push({day, restaurant: selectedRestaurant});
            } else {
                weekMenu.push({day, restaurant: "No restaurant available"});
            }
        });

        updateCalendarWithMenu(weekMenu);
    }


    function createCalendar() {
        let today = new Date();
        let currentMonth = today.getMonth();
        let currentYear = today.getFullYear();

        let firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay(); // 獲取當月第一天是星期幾
        let daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate(); // 獲取當月的天數

        let calendarDiv = document.getElementById("calendar");
        calendarDiv.innerHTML = ''; // 清除上次的日曆

        // 添加星期標題
        let dayNames = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
        let calendarHeaderRow = document.createElement("div");
        calendarHeaderRow.className = 'calendar-header';
        dayNames.forEach(dayName => {
            let dayElement = document.createElement("div");
            dayElement.innerText = dayName;
            calendarHeaderRow.appendChild(dayElement);
        });
        calendarDiv.appendChild(calendarHeaderRow);

        // 創建日曆格子
        let calendarGrid = document.createElement("div");
        calendarGrid.className = 'calendar-grid';

        // 在第一天之前添加空白格
        for (let i = 0; i < firstDayOfMonth; i++) {
            let emptyDayElement = document.createElement("div");
            emptyDayElement.className = 'calendar-day';
            calendarGrid.appendChild(emptyDayElement);
        }

        // 填充每個月的天數
        for (let day = 1; day <= daysInMonth; day++) {
            let dayElement = document.createElement("div");
            dayElement.innerText = day;
            dayElement.className = 'calendar-day';
            if (day === today.getDate() && currentMonth === today.getMonth()) {
                dayElement.classList.add("today");
            }
            calendarGrid.appendChild(dayElement);
        }

        calendarDiv.appendChild(calendarGrid);
    }


    function updateCalendarWithMenu(weekMenu) {
        let today = new Date();
        let dayOfWeek = today.getDay(); // 0 (Sunday) to 6 (Saturday)
        let currentDay = today.getDate();
        let calendarDays = document.querySelectorAll('.calendar-day');

        // 清除先前的晚餐安排
        calendarDays.forEach(dayElement => {
            let date = parseInt(dayElement.innerText.split('\n')[0]);
            dayElement.innerText = isNaN(date) ? '' : date;
        });

        weekMenu.forEach((menu, index) => {
            // 計算每天在日曆中的正確位置
            let dayPosition = currentDay - dayOfWeek + index + 1;
            let dayElement = Array.from(calendarDays).find(el => parseInt(el.innerText) === dayPosition);
            if (dayElement) {
                // dayElement.innerText += `\n${menu.day}: ${menu.restaurant}`;
                dayElement.innerText += `\n${menu.restaurant}`;
            }
        });
    }

    function updateCurrentMonthDisplay() {
        const monthNames = ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"];
        let currentMonth = new Date().getMonth();
        document.getElementById('currentMonth').innerText = monthNames[currentMonth] + ' 菜單';
    }

    // 呼叫此函數來更新月份顯示
    updateCurrentMonthDisplay();

    createCalendar();
    updateRestaurantList();
</script>

</body>
</html>
